# ğŸš€ ç§’æ€ç³»ç»Ÿé«˜å¹¶å‘æµ‹è¯•æŒ‡å—

## ğŸ“‹ æµ‹è¯•ç¯å¢ƒå‡†å¤‡

### å‰ç½®æ¡ä»¶æ£€æŸ¥

- âœ… Spring Boot åº”ç”¨å·²å¯åŠ¨ï¼ˆç«¯å£ 8080ï¼‰
- âœ… MySQL æ•°æ®åº“è¿è¡Œæ­£å¸¸ï¼ˆç«¯å£ 3306ï¼‰
- âœ… Redis ç¼“å­˜æœåŠ¡æ­£å¸¸ï¼ˆç«¯å£ 6379ï¼‰
- âœ… RabbitMQ æ¶ˆæ¯é˜Ÿåˆ—æ­£å¸¸ï¼ˆç«¯å£ 5672ï¼‰

### éªŒè¯æœåŠ¡çŠ¶æ€

```bash
# æ£€æŸ¥Dockerå®¹å™¨çŠ¶æ€
docker-compose ps

# æ£€æŸ¥åº”ç”¨å¥åº·çŠ¶æ€
curl "http://localhost:8080/api/seckill/health"
```

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤è¯¦è§£

### ç¬¬ 1 æ­¥ï¼šåŸºç¡€åŠŸèƒ½éªŒè¯

#### 1.1 åˆå§‹åŒ–æµ‹è¯•æ•°æ®

```bash
# ä¸ºä¼˜æƒ åˆ¸1è®¾ç½®100ä¸ªåº“å­˜
curl -X POST "http://localhost:8080/api/seckill/init?voucherId=1&stock=100"

# æ£€æŸ¥åˆå§‹åº“å­˜
curl "http://localhost:8080/api/seckill/stock/1"
```

**é¢„æœŸç»“æœï¼š**

```json
{
  "voucherId": 1,
  "currentStock": 100,
  "timestamp": 1693564800000
}
```

#### 1.2 å•æ¬¡ç§’æ€æµ‹è¯•

```bash
# ç”¨æˆ·1001è¿›è¡Œç¬¬ä¸€æ¬¡ç§’æ€
curl -X POST "http://localhost:8080/api/seckill" \
  -H "Content-Type: application/json" \
  -d '{"userId":1001,"voucherId":1,"limit":1}'
```

**é¢„æœŸç»“æœï¼š**

```json
{
  "code": 0,
  "message": "ç§’æ€æˆåŠŸï¼Œæ­£åœ¨ä¸ºæ‚¨ç”Ÿæˆè®¢å•...",
  "orderId": 1693564801001001,
  "timestamp": 1693564801000
}
```

#### 1.3 éªŒè¯åº“å­˜å˜åŒ–

```bash
# æ£€æŸ¥åº“å­˜æ˜¯å¦å‡å°‘1
curl "http://localhost:8080/api/seckill/stock/1"

# æ£€æŸ¥ç”¨æˆ·è´­ä¹°è®°å½•
curl "http://localhost:8080/api/seckill/bought?voucherId=1&userId=1001"
```

#### 1.4 é™è´­é€»è¾‘æµ‹è¯•

```bash
# åŒä¸€ç”¨æˆ·å†æ¬¡å°è¯•è´­ä¹°ï¼ˆåº”è¯¥è¢«æ‹’ç»ï¼‰
curl -X POST "http://localhost:8080/api/seckill" \
  -H "Content-Type: application/json" \
  -d '{"userId":1001,"voucherId":1,"limit":1}'
```

**é¢„æœŸç»“æœï¼š**

```json
{
  "code": 2,
  "message": "è¶…è¿‡ä¸ªäººé™è´­æ•°é‡",
  "orderId": null,
  "timestamp": 1693564802000
}
```

---

### ç¬¬ 2 æ­¥ï¼šå°è§„æ¨¡å¹¶å‘æµ‹è¯•ï¼ˆé¢„çƒ­ï¼‰

```bash
# é‡æ–°åˆå§‹åŒ–åº“å­˜
curl -X POST "http://localhost:8080/api/seckill/init?voucherId=1&stock=50"

# æ‰§è¡Œ10ä¸ªå¹¶å‘ç”¨æˆ·æµ‹è¯•
python scripts/concurrent-test.py --users 10 --voucher-id 1 --limit 1
```

**é¢„æœŸç»“æœåˆ†æï¼š**

- æˆåŠŸè´­ä¹°ï¼š10 ä¸ªç”¨æˆ·
- åº“å­˜ä¸è¶³ï¼š0 ä¸ªç”¨æˆ·
- è¶…è¿‡é™è´­ï¼š0 ä¸ªç”¨æˆ·
- æ•°æ®ä¸€è‡´æ€§ï¼šâœ… é€šè¿‡

---

### ç¬¬ 3 æ­¥ï¼šä¸­ç­‰è§„æ¨¡å¹¶å‘æµ‹è¯•

```bash
# åˆå§‹åŒ–æ›´å¤§åº“å­˜
curl -X POST "http://localhost:8080/api/seckill/init?voucherId=2&stock=100"

# æ‰§è¡Œ100ä¸ªå¹¶å‘ç”¨æˆ·æµ‹è¯•
python scripts/concurrent-test.py --users 100 --voucher-id 2 --limit 1
```

**å…³é”®éªŒè¯ç‚¹ï¼š**

- æˆåŠŸè´­ä¹°æ•°é‡ = åº“å­˜æ•°é‡
- å“åº”æ—¶é—´ < 200ms
- æ—  HTTP é”™è¯¯
- æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥é€šè¿‡

---

### ç¬¬ 4 æ­¥ï¼šé«˜å¹¶å‘å‹åŠ›æµ‹è¯•

#### 4.1 1000 ç”¨æˆ·æŠ¢ 100 åº“å­˜

```bash
# åˆå§‹åŒ–åº“å­˜
curl -X POST "http://localhost:8080/api/seckill/init?voucherId=3&stock=100"

# æ‰§è¡Œ1000å¹¶å‘æµ‹è¯•
python scripts/concurrent-test.py --users 1000 --voucher-id 3 --limit 1 --max-workers 50
```

#### 4.2 2000 ç”¨æˆ·æŠ¢ 200 åº“å­˜ï¼ˆæé™æµ‹è¯•ï¼‰

```bash
# åˆå§‹åŒ–æ›´å¤§åº“å­˜
curl -X POST "http://localhost:8080/api/seckill/init?voucherId=4&stock=200"

# æ‰§è¡Œè¶…é«˜å¹¶å‘æµ‹è¯•
python scripts/concurrent-test.py --users 2000 --voucher-id 4 --limit 1 --max-workers 100
```

**æ€§èƒ½ç›®æ ‡ï¼š**

- QPS > 1000
- å¹³å‡å“åº”æ—¶é—´ < 100ms
- æˆåŠŸç‡ = åº“å­˜/æ€»è¯·æ±‚æ•°
- ç³»ç»Ÿç¨³å®šï¼Œæ— å´©æºƒ

---

### ç¬¬ 5 æ­¥ï¼šæ•°æ®ä¸€è‡´æ€§éªŒè¯

#### 5.1 Redis vs æ•°æ®åº“ä¸€è‡´æ€§æ£€æŸ¥

```bash
# æ£€æŸ¥Redisä¸­çš„åº“å­˜
curl "http://localhost:8080/api/seckill/stock/4"

# æ£€æŸ¥æ•°æ®åº“ä¸­çš„åº“å­˜
docker exec seckill-mysql mysql -u root -p123456 -D seckill_test -e "SELECT id, name, stock FROM coupons WHERE id = 4;"

# æ£€æŸ¥è®¢å•æ€»æ•°
docker exec seckill-mysql mysql -u root -p123456 -D seckill_test -e "SELECT COUNT(*) as total_orders FROM orders WHERE voucher_id = 4;"
```

#### 5.2 ä¸€è‡´æ€§éªŒè¯å…¬å¼

```
åˆå§‹åº“å­˜ = Rediså½“å‰åº“å­˜ + æ•°æ®åº“è®¢å•æ•°é‡
```

---

## ğŸ“Š ç›‘æ§å’Œåˆ†æ

### å®æ—¶ç›‘æ§é¢æ¿

1. **åº”ç”¨çŠ¶æ€ç›‘æ§**

   ```bash
   curl "http://localhost:8080/api/seckill/health"
   ```

2. **RabbitMQ ç®¡ç†ç•Œé¢**

   - è®¿é—®ï¼šhttp://localhost:15672
   - è´¦å·ï¼šguest / guest
   - å…³æ³¨ï¼šé˜Ÿåˆ—æ¶ˆæ¯æ•°ã€æ¶ˆè´¹é€Ÿç‡

3. **Redis ç®¡ç†ç•Œé¢**
   - è®¿é—®ï¼šhttp://localhost:8081
   - å…³æ³¨ï¼šå†…å­˜ä½¿ç”¨ã€å‘½ä»¤æ‰§è¡Œæ•°

### å…³é”®æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡       | ç›®æ ‡å€¼        | è¯´æ˜           |
| ---------- | ------------- | -------------- |
| QPS        | > 1000        | æ¯ç§’å¤„ç†è¯·æ±‚æ•° |
| å“åº”æ—¶é—´   | < 100ms       | å¹³å‡å“åº”æ—¶é—´   |
| æˆåŠŸç‡     | = åº“å­˜/è¯·æ±‚æ•° | ç²¾ç¡®åº“å­˜æ§åˆ¶   |
| é”™è¯¯ç‡     | < 0.1%        | HTTP é”™è¯¯æ¯”ä¾‹  |
| CPU ä½¿ç”¨ç‡ | < 80%         | ç³»ç»Ÿè´Ÿè½½       |
| å†…å­˜ä½¿ç”¨ç‡ | < 85%         | å†…å­˜ç®¡ç†       |

---

## ğŸ¯ é¢„æœŸæµ‹è¯•ç»“æœ

### 1000 ç”¨æˆ·æŠ¢ 100 åº“å­˜çš„ç†æƒ³ç»“æœ

```
ğŸ“Š æµ‹è¯•ç»“æœç»Ÿè®¡
============================================================
ğŸ“ æ€»è¯·æ±‚æ•°ï¼š1000
âœ… ç§’æ€æˆåŠŸï¼š100 (10.00%)
ğŸ“¦ åº“å­˜ä¸è¶³ï¼š900 (90.00%)
ğŸš« è¶…è¿‡é™è´­ï¼š0 (0.00%)
âŒ HTTPé”™è¯¯ï¼š0 (0.00%)
â° è¯·æ±‚è¶…æ—¶ï¼š0 (0.00%)

â±ï¸ å“åº”æ—¶é—´ç»Ÿè®¡ï¼ˆæ¯«ç§’ï¼‰ï¼š
  å¹³å‡å“åº”æ—¶é—´ï¼š45.23
  æœ€å°å“åº”æ—¶é—´ï¼š12.45
  æœ€å¤§å“åº”æ—¶é—´ï¼š156.78
  ä¸­ä½æ•°å“åº”æ—¶é—´ï¼š38.90

ğŸš€ å¹³å‡QPSï¼š1250.00

âœ… æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥é€šè¿‡
```

---

## âš¡ æ ¸å¿ƒæµ‹è¯•éªŒè¯ç‚¹

### 1. åŸå­æ€§éªŒè¯

- **æµ‹è¯•ç‚¹**ï¼šå¤šä¸ªå¹¶å‘è¯·æ±‚åŒæ—¶æ‰£å‡åº“å­˜
- **éªŒè¯**ï¼šæœ€ç»ˆåº“å­˜ = åˆå§‹åº“å­˜ - æˆåŠŸè®¢å•æ•°
- **æŠ€æœ¯**ï¼šRedis Lua è„šæœ¬ä¿è¯åŸå­æ€§

### 2. ä¸€è‡´æ€§éªŒè¯

- **æµ‹è¯•ç‚¹**ï¼šRedis ç¼“å­˜ vs æ•°æ®åº“æ•°æ®
- **éªŒè¯**ï¼šå¼‚æ­¥æ¶ˆæ¯å¤„ç†åæ•°æ®æœ€ç»ˆä¸€è‡´
- **æŠ€æœ¯**ï¼šRabbitMQ å¯é æ¶ˆæ¯æŠ•é€’

### 3. å¯ç”¨æ€§éªŒè¯

- **æµ‹è¯•ç‚¹**ï¼šé«˜å¹¶å‘ä¸‹ç³»ç»Ÿç¨³å®šæ€§
- **éªŒè¯**ï¼šæ— ç³»ç»Ÿå´©æºƒï¼Œæ­£å¸¸å“åº”
- **æŠ€æœ¯**ï¼šè¿æ¥æ± ã€é™æµã€ç›‘æ§

### 4. æ€§èƒ½éªŒè¯

- **æµ‹è¯•ç‚¹**ï¼šé«˜å¹¶å‘å¤„ç†èƒ½åŠ›
- **éªŒè¯**ï¼šQPSã€å“åº”æ—¶é—´è¾¾æ ‡
- **æŠ€æœ¯**ï¼šç¼“å­˜é¢„å¤„ç†ã€å¼‚æ­¥è§£è€¦

### 5. å¹‚ç­‰æ€§éªŒè¯

- **æµ‹è¯•ç‚¹**ï¼šæ¶ˆæ¯é‡å¤æ¶ˆè´¹å¤„ç†
- **éªŒè¯**ï¼šé‡å¤æ¶ˆæ¯ä¸å½±å“æ•°æ®å‡†ç¡®æ€§
- **æŠ€æœ¯**ï¼šå”¯ä¸€ç´¢å¼•ã€æ¶ˆæ¯ ID å»é‡

---

## ğŸš¨ å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1ï¼šè¿æ¥è¶…æ—¶

**ç°è±¡**ï¼šå¤§é‡è¿æ¥è¶…æ—¶é”™è¯¯
**æ’æŸ¥**ï¼š

```bash
# æ£€æŸ¥è¿æ¥æ± é…ç½®
curl "http://localhost:8080/actuator/metrics/hikaricp.connections.active"

# æ£€æŸ¥æ•°æ®åº“è¿æ¥æ•°
docker exec seckill-mysql mysql -u root -p123456 -e "SHOW PROCESSLIST;"
```

### é—®é¢˜ 2ï¼šæ¶ˆæ¯ç§¯å‹

**ç°è±¡**ï¼šRabbitMQ é˜Ÿåˆ—æ¶ˆæ¯å †ç§¯
**æ’æŸ¥**ï¼š

- è®¿é—® http://localhost:15672
- æ£€æŸ¥æ¶ˆè´¹è€…çŠ¶æ€
- æŸ¥çœ‹é”™è¯¯æ—¥å¿—

### é—®é¢˜ 3ï¼šæ•°æ®ä¸ä¸€è‡´

**ç°è±¡**ï¼šRedis åº“å­˜ä¸æ•°æ®åº“è®¢å•æ•°ä¸åŒ¹é…
**æ’æŸ¥**ï¼š

```bash
# æ£€æŸ¥å›æ»šæ—¥å¿—
curl "http://localhost:8080/api/seckill/rollback-logs"

# æ£€æŸ¥æ­»ä¿¡é˜Ÿåˆ—
# åœ¨RabbitMQç®¡ç†ç•Œé¢æŸ¥çœ‹seckill.order.dlx.queue
```

---

## ğŸ“ æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿

### æµ‹è¯•ç¯å¢ƒ

- åº”ç”¨ç‰ˆæœ¬ï¼š1.0.0
- æµ‹è¯•æ—¶é—´ï¼šYYYY-MM-DD HH:mm:ss
- æµ‹è¯•åœºæ™¯ï¼šN ç”¨æˆ·æŠ¢è´­ M ä¸ªåº“å­˜

### æµ‹è¯•ç»“æœ

- æ€»è¯·æ±‚æ•°ï¼š
- æˆåŠŸæ•°ï¼š
- å¤±è´¥æ•°ï¼š
- å¹³å‡å“åº”æ—¶é—´ï¼š
- QPSï¼š
- æ•°æ®ä¸€è‡´æ€§ï¼š

### ç»“è®º

- ç³»ç»Ÿç¨³å®šæ€§ï¼šâœ…/âŒ
- æ€§èƒ½è¾¾æ ‡ï¼šâœ…/âŒ
- æ•°æ®å‡†ç¡®æ€§ï¼šâœ…/âŒ
- å»ºè®®æ”¹è¿›ï¼š

---

## ğŸ‰ æµ‹è¯•å®Œæˆç¡®è®¤

å®Œæˆä»¥ä¸‹æ‰€æœ‰æµ‹è¯•åï¼Œä½ çš„é«˜å¹¶å‘ç§’æ€ç³»ç»ŸéªŒè¯å®Œæ¯•ï¼š

- [ ] åŸºç¡€åŠŸèƒ½æµ‹è¯• âœ…
- [ ] å°è§„æ¨¡å¹¶å‘æµ‹è¯• âœ…
- [ ] ä¸­ç­‰è§„æ¨¡å¹¶å‘æµ‹è¯• âœ…
- [ ] é«˜å¹¶å‘å‹åŠ›æµ‹è¯• âœ…
- [ ] æ•°æ®ä¸€è‡´æ€§éªŒè¯ âœ…
- [ ] æ€§èƒ½æŒ‡æ ‡è¾¾æ ‡ âœ…
- [ ] å¼‚å¸¸åœºæ™¯å¤„ç† âœ…

**æµ‹è¯•æˆåŠŸæ ‡å¿—ï¼š**

1. æ‰€æœ‰æµ‹è¯•åœºæ™¯é€šè¿‡
2. æ•°æ®ä¸€è‡´æ€§ 100%å‡†ç¡®
3. ç³»ç»Ÿåœ¨é«˜å¹¶å‘ä¸‹ç¨³å®šè¿è¡Œ
4. æ€§èƒ½æŒ‡æ ‡è¾¾åˆ°é¢„æœŸç›®æ ‡

ç°åœ¨å¯ä»¥å¼€å§‹æŒ‰ç…§è¿™ä¸ªæŒ‡å—è¿›è¡Œæµ‹è¯•äº†ï¼ğŸš€
